<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Docker离线安装部署 | 一颗牙疼</title>
    <meta name="generator" content="VuePress 1.9.7">
    
    <meta name="description" content="Just playing around">
    
    <link rel="preload" href="/assets/css/0.styles.9825735b.css" as="style"><link rel="preload" href="/assets/js/app.f1b473bd.js" as="script"><link rel="preload" href="/assets/js/2.fe0fd2e3.js" as="script"><link rel="preload" href="/assets/js/83.5a791c98.js" as="script"><link rel="prefetch" href="/assets/js/10.33590986.js"><link rel="prefetch" href="/assets/js/100.f78ba335.js"><link rel="prefetch" href="/assets/js/101.144e6339.js"><link rel="prefetch" href="/assets/js/102.aff501b7.js"><link rel="prefetch" href="/assets/js/103.dce26470.js"><link rel="prefetch" href="/assets/js/104.26548958.js"><link rel="prefetch" href="/assets/js/11.e176da1e.js"><link rel="prefetch" href="/assets/js/12.e17f1dc0.js"><link rel="prefetch" href="/assets/js/13.b24f9ea2.js"><link rel="prefetch" href="/assets/js/14.347b4cb2.js"><link rel="prefetch" href="/assets/js/15.25c18adb.js"><link rel="prefetch" href="/assets/js/16.b82deb5e.js"><link rel="prefetch" href="/assets/js/17.4b8eda5c.js"><link rel="prefetch" href="/assets/js/18.94f035df.js"><link rel="prefetch" href="/assets/js/19.f9f0fb9a.js"><link rel="prefetch" href="/assets/js/20.e0617732.js"><link rel="prefetch" href="/assets/js/21.ded72680.js"><link rel="prefetch" href="/assets/js/22.a7d10053.js"><link rel="prefetch" href="/assets/js/23.2a865452.js"><link rel="prefetch" href="/assets/js/24.78892c84.js"><link rel="prefetch" href="/assets/js/25.754b8f95.js"><link rel="prefetch" href="/assets/js/26.83bff54d.js"><link rel="prefetch" href="/assets/js/27.5f6e1d66.js"><link rel="prefetch" href="/assets/js/28.0d045f90.js"><link rel="prefetch" href="/assets/js/29.df8cae72.js"><link rel="prefetch" href="/assets/js/3.9424d082.js"><link rel="prefetch" href="/assets/js/30.487b6d63.js"><link rel="prefetch" href="/assets/js/31.981a689c.js"><link rel="prefetch" href="/assets/js/32.4054d6a4.js"><link rel="prefetch" href="/assets/js/33.82377f32.js"><link rel="prefetch" href="/assets/js/34.422c6876.js"><link rel="prefetch" href="/assets/js/35.1bd78c05.js"><link rel="prefetch" href="/assets/js/36.763eef96.js"><link rel="prefetch" href="/assets/js/37.b9f362d0.js"><link rel="prefetch" href="/assets/js/38.81fa7d88.js"><link rel="prefetch" href="/assets/js/39.9d65c1ee.js"><link rel="prefetch" href="/assets/js/4.0b2df6d7.js"><link rel="prefetch" href="/assets/js/40.62236695.js"><link rel="prefetch" href="/assets/js/41.5fe37bc2.js"><link rel="prefetch" href="/assets/js/42.0535a0c4.js"><link rel="prefetch" href="/assets/js/43.959d2b22.js"><link rel="prefetch" href="/assets/js/44.4f5d7e45.js"><link rel="prefetch" href="/assets/js/45.95b3c34a.js"><link rel="prefetch" href="/assets/js/46.54a00035.js"><link rel="prefetch" href="/assets/js/47.5dce1505.js"><link rel="prefetch" href="/assets/js/48.02394ae9.js"><link rel="prefetch" href="/assets/js/49.df5ab6b8.js"><link rel="prefetch" href="/assets/js/5.60d4a913.js"><link rel="prefetch" href="/assets/js/50.f23015f8.js"><link rel="prefetch" href="/assets/js/51.3c1268b6.js"><link rel="prefetch" href="/assets/js/52.582990b8.js"><link rel="prefetch" href="/assets/js/53.336d30d8.js"><link rel="prefetch" href="/assets/js/54.382ffa0c.js"><link rel="prefetch" href="/assets/js/55.b022076f.js"><link rel="prefetch" href="/assets/js/56.d648021f.js"><link rel="prefetch" href="/assets/js/57.daee90c0.js"><link rel="prefetch" href="/assets/js/58.1dc75068.js"><link rel="prefetch" href="/assets/js/59.8e0aa66f.js"><link rel="prefetch" href="/assets/js/6.a104c4e0.js"><link rel="prefetch" href="/assets/js/60.5971fa7d.js"><link rel="prefetch" href="/assets/js/61.b5d38972.js"><link rel="prefetch" href="/assets/js/62.479ee1ec.js"><link rel="prefetch" href="/assets/js/63.9288134c.js"><link rel="prefetch" href="/assets/js/64.fd1fa594.js"><link rel="prefetch" href="/assets/js/65.6d7c8876.js"><link rel="prefetch" href="/assets/js/66.12eb7c68.js"><link rel="prefetch" href="/assets/js/67.ec6b9968.js"><link rel="prefetch" href="/assets/js/68.40a7cbed.js"><link rel="prefetch" href="/assets/js/69.1f663e2c.js"><link rel="prefetch" href="/assets/js/7.661a7c8f.js"><link rel="prefetch" href="/assets/js/70.a4b59650.js"><link rel="prefetch" href="/assets/js/71.d0a17b3b.js"><link rel="prefetch" href="/assets/js/72.ce31e327.js"><link rel="prefetch" href="/assets/js/73.689c681b.js"><link rel="prefetch" href="/assets/js/74.c3ee0764.js"><link rel="prefetch" href="/assets/js/75.631b23c2.js"><link rel="prefetch" href="/assets/js/76.5639d6d8.js"><link rel="prefetch" href="/assets/js/77.535d056c.js"><link rel="prefetch" href="/assets/js/78.4a10c037.js"><link rel="prefetch" href="/assets/js/79.1c4b1b82.js"><link rel="prefetch" href="/assets/js/8.cbcbaa9c.js"><link rel="prefetch" href="/assets/js/80.378f84af.js"><link rel="prefetch" href="/assets/js/81.cd50c718.js"><link rel="prefetch" href="/assets/js/82.fa313785.js"><link rel="prefetch" href="/assets/js/84.9deb80df.js"><link rel="prefetch" href="/assets/js/85.995a3a07.js"><link rel="prefetch" href="/assets/js/86.364d88cb.js"><link rel="prefetch" href="/assets/js/87.20848abb.js"><link rel="prefetch" href="/assets/js/88.b816d218.js"><link rel="prefetch" href="/assets/js/89.6bf9b49e.js"><link rel="prefetch" href="/assets/js/9.bbc07289.js"><link rel="prefetch" href="/assets/js/90.9e0ab005.js"><link rel="prefetch" href="/assets/js/91.5e91a1b3.js"><link rel="prefetch" href="/assets/js/92.64c206ac.js"><link rel="prefetch" href="/assets/js/93.8af7b9b1.js"><link rel="prefetch" href="/assets/js/94.83bb9556.js"><link rel="prefetch" href="/assets/js/95.1690cd1a.js"><link rel="prefetch" href="/assets/js/96.66883dcc.js"><link rel="prefetch" href="/assets/js/97.59f65ae5.js"><link rel="prefetch" href="/assets/js/98.0bf9d181.js"><link rel="prefetch" href="/assets/js/99.0fdea2a2.js">
    <link rel="stylesheet" href="/assets/css/0.styles.9825735b.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/img/logo.jpg" alt="一颗牙疼" class="logo"> <span class="site-name can-hide">一颗牙疼</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/01.Java/" class="nav-link">
  笔记
</a></div><div class="nav-item"><a href="https://github.com/Atoothache/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/01.Java/" class="nav-link">
  笔记
</a></div><div class="nav-item"><a href="https://github.com/Atoothache/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Java</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Spring</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>数据库</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>框架</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>服务器</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Linux</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>前端</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>脚本语言</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>模板引擎</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>安全认证</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>设计模式</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>搜索引擎</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Python</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>工具</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/14.工具/Docker离线安装部署.html" class="active sidebar-link">Docker离线安装部署</a></li><li><a href="/14.工具/Jenkins使用教程.html" class="sidebar-link">Jenkins使用教程</a></li><li><a href="/14.工具/Jenkins项目git构建.html" class="sidebar-link">Jenkins项目git构建</a></li><li><a href="/14.工具/Jmeter使用.html" class="sidebar-link">Jmeter使用</a></li><li><a href="/14.工具/flyway使用.html" class="sidebar-link">flyway使用</a></li><li><a href="/14.工具/oracle与达梦区别.html" class="sidebar-link">oracle与达梦区别</a></li><li><a href="/14.工具/用 exp 、 imp 数 据 导出导 入.html" class="sidebar-link">用 exp 、 imp 数 据 导出导 入</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>分布式</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>中间件</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Netty</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>杂文</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="docker离线安装部署"><a href="#docker离线安装部署" class="header-anchor">#</a> Docker离线安装部署</h1> <p>docker安装包下载地址：<a href="https://download.docker.com/linux/static/stable/x86_64/" target="_blank" rel="noopener noreferrer">https://download.docker.com/linux/static/stable/x86_64/<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h1 id="创建系统配置文件"><a href="#创建系统配置文件" class="header-anchor">#</a> 创建系统配置文件</h1> <p><strong>创建文件：</strong></p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token function">vim</span> /opt/docker/docker.service
</code></pre></div><p><strong>内容如下：</strong></p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token punctuation">[</span>Unit<span class="token punctuation">]</span>
<span class="token assign-left variable">Description</span><span class="token operator">=</span>Docker Application Container Engine
<span class="token assign-left variable">Documentation</span><span class="token operator">=</span>https://docs.docker.com
<span class="token assign-left variable">After</span><span class="token operator">=</span>network-online.target firewalld.service
<span class="token assign-left variable">Wants</span><span class="token operator">=</span>network-online.target

<span class="token punctuation">[</span>Service<span class="token punctuation">]</span>
<span class="token assign-left variable">Type</span><span class="token operator">=</span>notify
<span class="token comment"># the default is not to use systemd for cgroups because the delegate issues still</span>
<span class="token comment"># exists and systemd currently does not support the cgroup feature set required</span>
<span class="token comment"># for containers run by docker</span>
<span class="token assign-left variable">ExecStart</span><span class="token operator">=</span>/usr/bin/dockerd
<span class="token assign-left variable">ExecReload</span><span class="token operator">=</span>/bin/kill -s HUP <span class="token variable">$MAINPID</span>
<span class="token comment"># Having non-zero Limit*s causes performance problems due to accounting overhead</span>
<span class="token comment"># in the kernel. We recommend using cgroups to do container-local accounting.</span>
<span class="token assign-left variable">LimitNOFILE</span><span class="token operator">=</span>infinity
<span class="token assign-left variable">LimitNPROC</span><span class="token operator">=</span>infinity
<span class="token assign-left variable">LimitCORE</span><span class="token operator">=</span>infinity
<span class="token comment"># Uncomment TasksMax if your systemd version supports it.</span>
<span class="token comment"># Only systemd 226 and above support this version.</span>
<span class="token comment">#TasksMax=infinity</span>
<span class="token assign-left variable">TimeoutStartSec</span><span class="token operator">=</span><span class="token number">0</span>
<span class="token comment"># set delegate yes so that systemd does not reset the cgroups of docker containers</span>
<span class="token assign-left variable">Delegate</span><span class="token operator">=</span>yes
<span class="token comment"># kill only the docker process, not all processes in the cgroup</span>
<span class="token assign-left variable">KillMode</span><span class="token operator">=</span>process
<span class="token comment"># restart the docker process if it exits prematurely</span>
<span class="token assign-left variable">Restart</span><span class="token operator">=</span>on-failure
<span class="token assign-left variable">StartLimitBurst</span><span class="token operator">=</span><span class="token number">3</span>
<span class="token assign-left variable">StartLimitInterval</span><span class="token operator">=</span>60s

<span class="token punctuation">[</span>Install<span class="token punctuation">]</span>
<span class="token assign-left variable">WantedBy</span><span class="token operator">=</span>multi-user.target
</code></pre></div><p>创建安装脚本</p> <div class="language- extra-class"><pre class="language-text"><code>vim /opt/docker/install.sh
</code></pre></div><p>内容如下：</p> <div class="language- extra-class"><pre class="language-text"><code>#!/bin/sh
echo '解压tar包...'
tar -xvf $1
echo '将docker目录移到/usr/bin目录下...'
cp docker/* /usr/bin/
echo '将docker.service 移到/etc/systemd/system/ 目录...'
cp docker.service /etc/systemd/system/
echo '添加文件权限...'
chmod +x /etc/systemd/system/docker.service
echo '重新加载配置文件...'
systemctl daemon-reload
echo '启动docker...'
systemctl start docker
echo '设置开机自启...'
systemctl enable docker.service
echo 'docker安装成功...'
docker -v
</code></pre></div><h4 id="创建卸载脚本"><a href="#创建卸载脚本" class="header-anchor">#</a> 创建卸载脚本</h4> <div class="language- extra-class"><pre class="language-text"><code>vim /opt/docker/uninstall.sh
</code></pre></div><div class="language-shell extra-class"><pre class="language-shell"><code><span class="token shebang important">#!/bin/sh</span>
<span class="token builtin class-name">echo</span> <span class="token string">'删除docker.service...'</span>
<span class="token function">rm</span> -f /etc/systemd/system/docker.service
<span class="token builtin class-name">echo</span> <span class="token string">'删除docker文件...'</span>
<span class="token function">rm</span> -rf /usr/bin/docker*
<span class="token builtin class-name">echo</span> <span class="token string">'重新加载配置文件'</span>
systemctl daemon-reload
<span class="token builtin class-name">echo</span> <span class="token string">'卸载成功...'</span>
</code></pre></div><p><strong>执行安装脚本：</strong></p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token function">sh</span> install.sh docker-20.10.9.tgz
</code></pre></div><h1 id="配置国内源"><a href="#配置国内源" class="header-anchor">#</a> 配置国内源</h1> <div class="language- extra-class"><pre class="language-text"><code>vim /etc/docker/daemon.json

{
 &quot;registry-mirrors&quot; : [
   &quot;https://mirror.ccs.tencentyun.com&quot;,
   &quot;http://registry.docker-cn.com&quot;,
   &quot;http://docker.mirrors.ustc.edu.cn&quot;,
   &quot;http://hub-mirror.c.163.com&quot;
 ],
 &quot;insecure-registries&quot; : [
   &quot;registry.docker-cn.com&quot;,
   &quot;docker.mirrors.ustc.edu.cn&quot;
 ],
 &quot;debug&quot; : true,
 &quot;experimental&quot; : true
}
</code></pre></div><div class="language-shell extra-class"><pre class="language-shell"><code>systemctl daemon-reload
<span class="token comment">#重启docker</span>
systemctl restart docker.service
</code></pre></div><div class="language- extra-class"><pre class="language-text"><code>安装过程遇到的问题：
1、现象

使用systemctl start docker启动很慢，并且呈现卡死状态，无任何反应。

使用systemctl status docker发现docker一直处于Active: activating (start)

2、可能的原因
 服务器重启之后防火墙先于docker重启，docker无法操作防火墙导致重启卡死。

3、解决方法

关闭防火墙systemctl stop firewalld并查看关闭情况
重启服务器
启动docker systemctl start docker 并查看启动情况
开启防火墙 systemctl start firewalld

————————————————

版权声明：本文为CSDN博主「一恍过去」的原创文章，遵循CC 4.0 BY-SA版权协议，转载请附上原文出处链接及本声明。

原文链接：https://blog.csdn.net/zhuocailing3390/article/details/121797180

</code></pre></div><div class="language- extra-class"><pre class="language-text"><code>先介绍一下虚拟机的网络模式
生成的虚拟设备

VMnet0：用于虚拟桥接网络下的虚拟交换机
VMnet1：用于虚拟Host-Only网络下的虚拟交换机
VMnet8：用于虚拟NAT网络下的虚拟交换机
VMware NetworkAdepter VMnet1：Host用于与Host-Only虚拟网络进行通信的虚拟网卡
VMware NetworkAdepter VMnet8：Host用于与NAT虚拟网络进行通信的虚拟网卡

一般具有这样的对应关系
桥接
在这种模式下，VMware虚拟出来的操作系统就像是局域网中的一台独立的主机，它可以访问网内任何一台机器。需要手工为虚拟系统配置IP地址、子网掩码，而且还要和宿主机器处于同一网段，这样虚拟系统才能和宿主机器进行通信。同时，由于这个虚拟系统是局域网中的一个独立的主机系统，那么就可以手工配置它的TCP/IP配置信息，以实现通过局域网的网关或路由器访问互联网。

NAT
使用NAT模式，就是让虚拟系统借助NAT(网络地址转换)功能，通过宿主机器所在的网络来访问公网。也就是说，使用NAT模式可以实现在虚拟系统里访问互联网。NAT模式下的虚拟系统的TCP/IP配置信息是由VMnet8(NAT)虚拟网络的DHCP服务器提供的，无法进行手工修改，因此虚拟系统也就无法和本局域网中的其他真实主机进行通讯。采用NAT模式最大的优势是虚拟系统接入互联网非常简单，不需要进行任何其他的配置，只需要主机器能访问互联网即可。这种情况下，主机可以ping通虚拟机，虚拟机也能ping通主机。
Host-Only
Host-Only模式其实就是NAT模式去除了虚拟NAT设备，然后使用VMware Network Adapter VMnet1虚拟网卡连接VMnet1虚拟交换机来与虚拟机通信的，Host-Only模式将虚拟机与外网隔开，使得虚拟机成为一个独立的系统，只与主机相互通讯。

关于docker的网络模式
docker使用linux桥接，在宿主机虚拟一个Docker容器网桥(docker0)，Docker启动一个容器时会根据Docker网桥的网段分配给容器一个IP地址，称为Container-IP，同时Docker网桥是每个容器的默认网关。因为在同一宿主机内的容器都接入同一个网桥，这样容器之间就能够通过容器的Container-IP直接通信。

由于docker网桥是虚拟出来的，外部网络无法寻址到 ，也就是说外部网络无法直接通过container_ip来访问容器，此时就需要使用端口映射（映射容器端口到宿主主机），docker run创建容器时候通过 -p 或 -P 参数来启用，访问容器的时候就通过[宿主机IP]:[容器端口]访问容器

四种网络模式总览

host模式 –net=host 容器和宿主机共享Network namespace。
container模式 –net=container:NAME_or_ID 容器和另外一个容器共享Network namespace。
none模式 –net=none 容器有独立的Network namespace，但并没有对其进行任何网络设置，如分配veth pair 和网桥连接，配置IP等。
bridge模式 –net=bridge （默认为该模式）
Host模式
容器将不会获得一个独立的Network Namespace，而是和宿主机共用一个Network Namespace。容器将不会虚拟出自己的网卡，配置自己的IP等，而是使用宿主机的IP和端口。但是，容器的其他方面，如文件系统、进程列表等还是和宿主机隔离的。

使用host模式的容器可以直接使用宿主机的IP地址与外界通信，容器内部的服务端口也可以使用宿主机的端口，不需要进行NAT，host最大的优势就是网络性能比较好，但是docker host上已经使用的端口就不能再用了，网络的隔离性不好。

container模式
指定新创建的容器和已经存在的一个容器共享一个 Network Namespace，而不是和宿主机共享。新创建的容器不会创建自己的网卡，配置自己的 IP，而是和一个指定的容器共享 IP、端口范围等。同样，两个容器除了网络方面，其他的如文件系统、进程列表等还是隔离的。两个容器的进程可以通过 lo 网卡设备通信。

[外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传(img-nZgeXJwP-1652531930546)(D:\Utilities\Typora\images\webp)]

none模式
none模式，Docker容器拥有自己的Network Namespace，但是，并不为Docker容器进行任何网络配置。也就是说，这个Docker容器没有网卡、IP、路由等信息。需要我们自己为Docker容器添加网卡、配置IP等。

bridge模式
当Docker进程启动时，会在主机上创建一个名为docker0的虚拟网桥，此主机上启动的Docker容器会连接到这个虚拟网桥上。虚拟网桥的工作方式和物理交换机类似，这样主机上的所有容器就通过交换机连在了一个二层网络中。

从docker0子网中分配一个IP给容器使用，并设置docker0的IP地址为容器的默认网关。在主机上创建一对虚拟网卡veth pair设备，Docker将veth pair设备的一端放在新创建的容器中，并命名为eth0（容器的网卡），另一端放在主机中，以vethxxx这样类似的名字命名，并将这个网络设备加入到docker0网桥中。可以通过brctl show命令查看。

bridge模式是docker的默认网络模式，不写–net参数，就是bridge模式。使用docker run -p时，docker实际是在iptables做了DNAT规则，实现端口转发功能。可以使用iptables -t nat -vnL查看。
————————————————
版权声明：本文为CSDN博主「LRY01127」的原创文章，遵循CC 4.0 BY-SA版权协议，转载请附上原文出处链接及本声明。
原文链接：https://blog.csdn.net/weixin_56416440/article/details/124773678
</code></pre></div><div class="language- extra-class"><pre class="language-text"><code>安装oracle:
 docker pull registry.cn-hangzhou.aliyuncs.com/helowin/oracle_11g
 
 docker run -d --name oracle --net=host registry.cn-hangzhou.aliyuncs.com/helowin/oracle_11g
 
 docker exec -it oracle bash
 切到root用户
 su 
 
 helowin
 
 cd /home/oracle/app/oracle/product/11.2.0/dbhome_2/
 
 配置环境变量
 vi /etc/profile
加在最下面
export ORACLE_HOME=/home/oracle/app/oracle/product/11.2.0/dbhome_2/
export ORACLE_SID=helowin
export PATH=$PATH:$ORACLE_HOME/bin
刷新环境变量
source /etc/profile
切回oracle用户
su - oracle

登录sqlplus
sqlplus /nolog
连接数据库用户
SQL&gt; conn /as sysdba;
修改system用户
alter user system identified by 123456;
alter user sys identified by 123456;
alter profile default limit PASSWORD_LIFE_TIME unlimited;
</code></pre></div><div class="language- extra-class"><pre class="language-text"><code>安装mysql：
docker pull mysql:8.0

mkdir -p /data/mysql/log
mkdir -p /data/mysql/data
mkdir -p /data/mysql/conf
vim /data/mysql/conf/my.cnf

[client]
default-character-set=utf8mb4
[mysql]
default-character-set=utf8mb4
[mysqld]
character-set-server=utf8mb4
default-time-zone=+8:00
secure_file_priv=NULL
max_allowed_packet=2G

docker run -p 3306:3306 --name mysql8 --privileged=true -v /data/mysql/log:/var/log/mysql:rw -v /data/mysql/data:/var/lib/mysql:rw -v /data/mysql/conf:/etc/mysql/conf.d:rw  -v /etc/localtime:/etc/localtime:ro -e MYSQL_ROOT_PASSWORD=faduitdragon -d mysql:8.0


三、连接MySQL
1、进入mysql容器
docker exec -it mysql /bin/bash

2、登陆mysql
mysql -u root -p

3、mysql 8 设置允许远程用户访问
use mysql;
update user set host = '%' where user = 'root' and host='localhost'; # 更新root - localhost 为 root - %

GRANT ALL ON *.* TO 'root'@'%'; # 设置允许远程用户访问

flush privileges;# 刷新权限

ALTER USER 'root'@'%' IDENTIFIED WITH mysql_native_password BY '密码';#更新用户加密方式，mysql8默认的加密方式为caching_sha2_password 与mysql5的加密方式mysql_native_password 不同

</code></pre></div><div class="language- extra-class"><pre class="language-text"><code>nginx安装 (nginx最新版本不包含SSL模块   1.23.4版本包含)
docker pull nginx
mkdir -p /data/nginx/conf.d
vi /data/nginx/conf.d/80.conf

server{
        listen 80;

        location / {
                root /usr/share/nginx/html;
        }
}


docker run -d --name nginx --net=host --privileged -v /data/nginx/conf.d/:/etc/nginx/conf.d nginx

docker run -d --name nginx-web --net=host --privileged  -v /docker/nginx/cert:/etc/nginx/cert -v /docker/nginx/conf/nginx.conf:/etc/nginx/nginx.conf -v /docker/nginx/html:/usr/share/nginx/html -v /docker/nginx/log:/var/log/nginx  nginx:1.23.4

docker run -d --name nginx --net=host --privileged  -v /data/nginx/cert:/etc/nginx/cert  -v /data/nginx/conf:/etc/nginx -v /data/nginx/html:/usr/share/nginx/html -v /data/nginx/log:/var/log/nginx  nginx:1.20.1

</code></pre></div><div class="language- extra-class"><pre class="language-text"><code>rabbitmq 安装

docker pull rabbitmq:3.8.25-management
docker run -d --name rabbitmq -p 15672:15672 -p 5672:5672 rabbitmq:3.8.25-management
docker run -d --name rabbitmq --net=host rabbitmq:3.8.25-management

通过docker ps -a查看部署的mq容器id，在通过 docker exec -it 容器id /bin/bash 进入容器内部在
运行：rabbitmq-plugins enable rabbitmq_management

主要端口介绍
4369 -- erlang发现口
5672 -- client端通信口
15672 -- 管理界面ui端口
25672 -- server间内部通信口
</code></pre></div><div class="language- extra-class"><pre class="language-text"><code>redis 安装

docker pull redis

mkdir /data/redis
cd /data/redis
wget http://download.redis.io/redis-stable/redis.conf
chmod 777 redis.conf
vi /data/redis/redis.conf

bind 127.0.0.1 通过#注释掉，解除本地连接限制
protected-mode yes 默认no，保护模式，限制为本地访问，修改后解除保护模式
requirepass设置密码（建议设置，不设置有风险）

docker启动redis命令

docker run -p 6379:6379 --name redis --privileged=true  -v /data/redis/redis.conf:/etc/redis/redis.conf  -v /data/redis/data:/data -d redis redis-server /etc/redis/redis.conf

命令分析

-p 6379:6379 端口映射：前表示主机部分，：后表示容器部分。

–name redis 指定该容器名称，查看和进行操作都比较方便。

-v 挂载文件或目录 ：前表示主机部分，：后表示容器部分。

-d redis 表示后台启动redis

redis-server /etc/redis/redis.conf
以配置文件启动redis，加载容器内的conf文件，最终找到的是挂载的目录/usr/local/docker/redis.conf

</code></pre></div><div class="language- extra-class"><pre class="language-text"><code>jenkins安装
docker pull jenkins/jenkins:lts
docker run -d -p 18080:8080 -p 50000:50000 -v /docker/jenkins/jenkins_mount:/var/jenkins_home -v /etc/localtime:/etc/localtime --name jenkins jenkins/jenkins:lts



</code></pre></div><div class="language- extra-class"><pre class="language-text"><code>minio安装
docker run -p 9000:9000 -p 9090:9090 --name minio  -d --restart=always  -e &quot;MINIO_ACCESS_KEY=admin&quot;  -e &quot;MINIO_SECRET_KEY=0405@nan.minio&quot; -v /data/minio/data:/data bitnami/minio  server /data --console-address &quot;:9090&quot; -address &quot;:9000&quot;

</code></pre></div><div class="language- extra-class"><pre class="language-text"><code>rocketmq

拉取镜像
docker pull rocketmqinc/rocketmq
1
创建namesrv数据存储路径
mkdir -p  /docker/rocketmq/data/namesrv/logs   /docker/rocketmq/data/namesrv/store
1
构建namesrv容器
docker run -d \
--restart=always \
--name rmqnamesrv \
-p 9876:9876 \
-v /docker/rocketmq/data/namesrv/logs:/root/logs \
-v /docker/rocketmq/data/namesrv/store:/root/store \
-e &quot;MAX_POSSIBLE_HEAP=100000000&quot; \
rocketmqinc/rocketmq \
sh mqnamesrv 

参数	说明
-d	以守护进程的方式启动
-restart=always| docker重启时候容器自动重启
-name rmqnamesrv | 把容器的名字设置为rmqnamesrv
-p 9876:9876| 把容器内的端口9876挂载到宿主机9876上面
-v /docker/rocketmq/data/namesrv/logs:/root/logs | 把容器内的/root/logs日志目录挂载到宿主机的 /docker/rocketmq/data/namesrv/logs目录
-v /docker/rocketmq/data/namesrv/store:/root/store | 把容器内的/root/store数据存储目录挂载到宿主机的 /docker/rocketmq/data/namesrv目录
rmqnamesrv | 容器的名字
-e “MAX_POSSIBLE_HEAP=100000000” | 设置容器的最大堆内存为100000000
rocketmqinc/rocketmq | 使用的镜像名称
sh mqnamesrv | 启动namesrv服务
2.创建broker节点
创建broker数据存储路径
mkdir -p  /docker/rocketmq/data/broker/logs   /docker/rocketmq/data/broker/store /docker/rocketmq/conf
1
创建配置文件
vi /docker/rocketmq/conf/broker.conf
# 所属集群名称，如果节点较多可以配置多个
brokerClusterName = DefaultCluster
#broker名称，master和slave使用相同的名称，表明他们的主从关系
brokerName = broker-a
#0表示Master，大于0表示不同的slave
brokerId = 0
#表示几点做消息删除动作，默认是凌晨4点
deleteWhen = 04
#在磁盘上保留消息的时长，单位是小时
fileReservedTime = 48
#有三个值：SYNC_MASTER，ASYNC_MASTER，SLAVE；同步和异步表示Master和Slave之间同步数据的机制；
brokerRole = ASYNC_MASTER
#刷盘策略，取值为：ASYNC_FLUSH，SYNC_FLUSH表示同步刷盘和异步刷盘；SYNC_FLUSH消息写入磁盘后才返回成功状态，ASYNC_FLUSH不需要；
flushDiskType = ASYNC_FLUSH
# 设置broker节点所在服务器的ip地址
brokerIP1 = 192.168.52.136
# 磁盘使用达到95%之后,生产者再写入消息会报错 CODE: 14 DESC: service not available now, maybe disk full
diskMaxUsedSpaceRatio=95
1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
构建broker容器
docker run -d  \
--restart=always \
--name rmqbroker \
--link rmqnamesrv:namesrv \
-p 10911:10911 \
-p 10909:10909 \
-v  /docker/rocketmq/data/broker/logs:/root/logs \
-v  /docker/rocketmq/data/broker/store:/root/store \
-v /docker/rocketmq/conf/broker.conf:/opt/rocketmq-4.4.0/conf/broker.conf \
-e &quot;NAMESRV_ADDR=namesrv:9876&quot; \
-e &quot;MAX_POSSIBLE_HEAP=200000000&quot; \
rocketmqinc/rocketmq \
sh mqbroker -c /opt/rocketmq-4.4.0/conf/broker.conf 
1
2
3
4
5
6
7
8
9
10
11
12
13
参数	说明
-d	以守护进程的方式启动
–restart=always	docker重启时候镜像自动重启
-name rmqbroker | 把容器的名字设置为rmqbroker
–link rmqnamesrv:namesrv | 和rmqnamesrv容器通信
-p 10911:10911 | 把容器的非vip通道端口挂载到宿主机
-p 10909:10909 | 把容器的vip通道端口挂载到宿主机
-e “NAMESRV_ADDR=namesrv:9876” | 指定namesrv的地址为本机namesrv的ip地址:9876
-e “MAX_POSSIBLE_HEAP=200000000” rocketmqinc/rocketmq sh mqbroker | 指定broker服务的最大堆内存
rocketmqinc/rocketmq | 使用的镜像名称
sh mqbroker -c /opt/rocketmq-4.4.0/conf/broker.conf | 指定配置文件启动broker节点
3.创建rockermq-console服务
拉取镜像
docker pull pangliang/rocketmq-console-ng
1
构建rockermq-console容器
需要把192.168.52.136换成部署namesrv机器地址

docker run -d \
--restart=always \
--name rmqadmin \
-e &quot;JAVA_OPTS=-Drocketmq.namesrv.addr=192.168.52.136:9876 \
-Dcom.rocketmq.sendMessageWithVIPChannel=false&quot; \
-p 9999:8080 \
pangliang/rocketmq-console-ng
1
2
3
4
5
6
7
参数	说明
-d	以守护进程的方式启动
-restart=always| docker重启时候镜像自动重启
-name rmqadmin | 把容器的名字设置为rmqadmin
-e “JAVA_OPTS=-Drocketmq.namesrv.addr=192.168.52.136:9876 | 设置namesrv服务的ip地址
-Dcom.rocketmq.sendMessageWithVIPChannel=false” | 不使用vip通道发送消息
–p 9999:8080 | 把容器内的端口8080挂载到宿主机上的9999端口
需要关闭防火墙或者开放namesrv和broker端口


</code></pre></div><p><a href="https://blog.csdn.net/chenjun_base/article/details/120996109" target="_blank" rel="noopener noreferrer">(35条消息) 虚拟机中Linux扩容硬盘空间_chenjun_base的博客-CSDN博客_linux虚拟机扩容<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/13.python/爬虫.html" class="prev">
        爬虫
      </a></span> <span class="next"><a href="/14.工具/Jenkins使用教程.html">
        Jenkins使用教程
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.f1b473bd.js" defer></script><script src="/assets/js/2.fe0fd2e3.js" defer></script><script src="/assets/js/83.5a791c98.js" defer></script>
  </body>
</html>
