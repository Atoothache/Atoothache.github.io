(window.webpackJsonp=window.webpackJsonp||[]).push([[37],{309:function(t,s,a){"use strict";a.r(s);var e=a(13),n=Object(e.a)({},(function(){var t=this,s=t._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h1",{attrs:{id:"简介"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#简介"}},[t._v("#")]),t._v(" 简介")]),t._v(" "),s("blockquote",[s("p",[t._v("什么是nginx")])]),t._v(" "),s("p",[t._v("Nginx是一个高性能的HTTP和反向代理web服务器")]),t._v(" "),s("blockquote",[s("p",[t._v("安装要求")])]),t._v(" "),s("ul",[s("li",[s("p",[s("code",[t._v("linux")]),t._v("内核2.6及以上")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[t._v("uname")]),t._v(" -a\n")])])])]),t._v(" "),s("li",[s("p",[t._v("关闭防火墙")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 临时关闭防火墙")]),t._v("\nsystemctl stop firewalld\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 永久关闭防火墙")]),t._v("\nsystemctl disable firewalld\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 查看防火墙状态")]),t._v("\nsystemctl status firewalld\n")])])])])]),t._v(" "),s("h1",{attrs:{id:"安装nginx"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#安装nginx"}},[t._v("#")]),t._v(" 安装nginx")]),t._v(" "),s("h2",{attrs:{id:"源码安装"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#源码安装"}},[t._v("#")]),t._v(" 源码安装")]),t._v(" "),s("blockquote",[s("p",[t._v("创建文件夹")])]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[t._v("mkdir")]),t._v(" /data\n"),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("cd")]),t._v(" /data\n")])])]),s("blockquote",[s("p",[t._v("安装依赖")])]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[t._v("yum "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v(" -y gcc pcre-devel zlib-devel openssl-devel\n")])])]),s("blockquote",[s("p",[t._v("下载nginx")])]),t._v(" "),s("ul",[s("li",[s("p",[t._v("官网下载"),s("code",[t._v("http://nginx.org/en/download.html")])])]),t._v(" "),s("li",[s("p",[t._v("直接在服务器下载")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[t._v("wget")]),t._v(" https://nginx.org/download/nginx-1.22.0.tar.gz\n")])])])])]),t._v(" "),s("blockquote",[s("p",[t._v("进行配置")])]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[t._v("./configure "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n--prefix"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("/usr/local/nginx "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n--sbin-path"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("/usr/local/nginx/sbin/nginx "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n--modules-path"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("/usr/local/nginx/modules "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n--conf-path"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("/usr/local/nginx/conf/nginx.conf "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n--error-log-path"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("/usr/local/nginx/logs/error.log "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n--http-log-path"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("/usr/local/nginx/logs/access.log "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n--pid-path"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("/usr/local/nginx/logs/nginx.pid\n")])])]),s("ul",[s("li",[s("p",[t._v("配置文件详解")]),t._v(" "),s("table",[s("thead",[s("tr",[s("th",[t._v("--prefix=PATH")]),t._v(" "),s("th",[t._v("nginx安装目录，默认/uar/local/nginx")])])]),t._v(" "),s("tbody",[s("tr",[s("td",[t._v("--sbin-path=PATH")]),t._v(" "),s("td",[t._v("可执行文件路径，默认"),s("prefix",[t._v("/sbin/nginx")])],1)]),t._v(" "),s("tr",[s("td",[t._v("--modules-path=PATH")]),t._v(" "),s("td",[t._v("动态模块的安装目录，默认"),s("prefix",[t._v("/modules")])],1)]),t._v(" "),s("tr",[s("td",[t._v("--conf-path=PATH")]),t._v(" "),s("td",[t._v("配置文件路径，默认"),s("prefix",[t._v("/conf/nginx.conf")])],1)]),t._v(" "),s("tr",[s("td",[t._v("--error-log-path=PATH")]),t._v(" "),s("td",[t._v("错误日志文件路径，默认"),s("prefix",[t._v("/logs/error.log")])],1)]),t._v(" "),s("tr",[s("td",[t._v("--http-log-path=PATH")]),t._v(" "),s("td",[t._v("日志文件路径，默认"),s("prefix",[t._v("/logs/access.log")])],1)]),t._v(" "),s("tr",[s("td",[t._v("--pid-path=PATH")]),t._v(" "),s("td",[t._v("进程id文件路径，默认"),s("prefix",[t._v("/logs/nginx.pid")])],1)])])])])]),t._v(" "),s("blockquote",[s("p",[t._v("进行安装")])]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[t._v("make")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("make")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v("\n")])])]),s("h2",{attrs:{id:"yum安装"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#yum安装"}},[t._v("#")]),t._v(" yum安装")]),t._v(" "),s("blockquote",[s("p",[t._v("安装依赖")])]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[t._v("yum "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v(" -y yum-utils\n")])])]),s("blockquote",[s("p",[t._v("编辑配置文件")])]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[t._v("vim")]),t._v(" /etc/yum.repos.d/nginx.repo\n\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("nginx-stable"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("nginx stable repo\n"),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("baseurl")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("http://nginx.org/packages/centos/"),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$releasever")]),t._v("/"),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$basearch")]),t._v("/\n"),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("gpgcheck")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("enabled")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("gpgkey")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("https://nginx.org/keys/nginx_signing.key\n"),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("module_hotfixes")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("true\n\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("nginx-mainline"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("nginx mainline repo\n"),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("baseurl")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("http://nginx.org/packages/mainline/centos/"),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$releasever")]),t._v("/"),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$basearch")]),t._v("/\n"),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("gpgcheck")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("enabled")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("gpgkey")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("https://nginx.org/keys/nginx_signing.key\n"),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("module_hotfixes")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("true\n")])])]),s("blockquote",[s("p",[t._v("进行安装")])]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[t._v("yum "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v(" -y nginx\n")])])]),s("blockquote",[s("p",[t._v("查看安装目录")])]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[t._v("whereis")]),t._v(" nginx\n")])])]),s("h2",{attrs:{id:"配置系统服务"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#配置系统服务"}},[t._v("#")]),t._v(" 配置系统服务")]),t._v(" "),s("blockquote",[s("p",[t._v("编辑文件")])]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[t._v("vim")]),t._v(" /usr/lib/systemd/system/nginx.service\n")])])]),s("blockquote",[s("p",[t._v("添加以下内容")])]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("Unit"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("Description")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("nginx web "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("service")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("Documentation")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("http://nginx.org/en/docs/\n"),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("After")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("network.target\n\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("Service"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("Type")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("forking\n"),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("PIDFile")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("/usr/local/nginx/logs/nginx.pid\n"),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("ExecStartPre")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("/usr/local/nginx/sbin/nginx -t -c /usr/local/nginx/conf/nginx.conf\n"),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("ExecStart")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("/usr/local/nginx/sbin/nginx\n"),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("ExecReload")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("/usr/local/nginx/sbin/nginx -s reload\n"),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("ExecStop")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("/usr/local/nginx/sbin/nginx -s stop\n"),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("PrivateTmp")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("true\n\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("Install"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("WantedBy")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("default.target\n")])])]),s("h2",{attrs:{id:"配置环境变量"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#配置环境变量"}},[t._v("#")]),t._v(" 配置环境变量")]),t._v(" "),s("blockquote",[s("p",[t._v("编辑环境变量")])]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[t._v("vim")]),t._v(" /etc/profile\n")])])]),s("blockquote",[s("p",[t._v("最后一行添加以下内容")])]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("export")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s("span",{pre:!0,attrs:{class:"token environment constant"}},[t._v("PATH")])]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token environment constant"}},[t._v("$PATH")]),t._v(":/usr/local/nginx/sbin\n")])])]),s("blockquote",[s("p",[t._v("刷新环境变量")])]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("source")]),t._v(" /etc/profile\n")])])]),s("h1",{attrs:{id:"nginx操作"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#nginx操作"}},[t._v("#")]),t._v(" nginx操作")]),t._v(" "),s("h2",{attrs:{id:"目录结构介绍"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#目录结构介绍"}},[t._v("#")]),t._v(" 目录结构介绍")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[t._v("nginx\n├── conf\n│   ├── mime.types\n│   ├── mime.types.default\n│   ├── nginx.conf\n│   ├── nginx.conf.default\n├── html\n│   ├── 50x.html\n│   └── index.html\n├── logs\n│   ├── access.log\n│   ├── error.log\n│   └── nginx.pid\n├── sbin\n│   └── nginx\n")])])]),s("h2",{attrs:{id:"kill信号操作"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#kill信号操作"}},[t._v("#")]),t._v(" kill信号操作")]),t._v(" "),s("blockquote",[s("p",[t._v("查看nginx进程")])]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[t._v("ps")]),t._v(" -ef "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("grep")]),t._v(" nginx\n")])])]),s("blockquote",[s("p",[t._v("立即关闭")])]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[t._v("kill")]),t._v(" -term/int "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("id")]),t._v("\n")])])]),s("blockquote",[s("p",[t._v("优雅地关闭")])]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[t._v("kill")]),t._v(" -quit "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("id")]),t._v("\n")])])]),s("blockquote",[s("p",[t._v("重新加载配置文件")])]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[t._v("kill")]),t._v(" -hup "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("id")]),t._v("\n")])])]),s("blockquote",[s("p",[t._v("重写日志文件")])]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[t._v("kill")]),t._v(" -usr1 "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("id")]),t._v("\n")])])]),s("blockquote",[s("p",[t._v("平滑升级")])]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[t._v("kill")]),t._v(" -usr2 "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("id")]),t._v("\n")])])]),s("h2",{attrs:{id:"nginx命令"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#nginx命令"}},[t._v("#")]),t._v(" nginx命令")]),t._v(" "),s("blockquote",[s("p",[t._v("查看帮助")])]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[t._v("nginx -?\nnginx -h\n")])])]),s("p",[t._v("打印内容如下：")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[t._v("Options:\n  -?,-h         "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" this "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("help")]),t._v("\n  -v            "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" show version and "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("exit")]),t._v("\n  -V            "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" show version and configure options "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("then")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("exit")]),t._v("\n  -t            "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("test")]),t._v(" configuration and "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("exit")]),t._v("\n  -T            "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("test")]),t._v(" configuration, dump it and "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("exit")]),t._v("\n  -q            "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" suppress non-error messages during configuration testing\n  -s signal     "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" send signal to a master process: stop, quit, reopen, reload\n  -p prefix     "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("set")]),t._v(" prefix path "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("default: /usr/local/nginx/"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  -e filename   "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("set")]),t._v(" error log "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("file")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("default: logs/error.log"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  -c filename   "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("set")]),t._v(" configuration "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("file")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("default: conf/nginx.conf"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  -g directives "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("set")]),t._v(" global directives out of configuration "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("file")]),t._v("\n")])])]),s("blockquote",[s("p",[t._v("查看版本号")])]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[t._v("nginx -v\n")])])]),s("blockquote",[s("p",[t._v("查看版本号和安装时的配置信息")])]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[t._v("nginx -V\n")])])]),s("blockquote",[s("p",[t._v("测试配置文件语法")])]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[t._v("nginx -t\n")])])]),s("blockquote",[s("p",[t._v("测试配置文件语法，如果成功则输出文件内容")])]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[t._v("nginx -T\n")])])]),s("blockquote",[s("p",[t._v("发送信号")])]),t._v(" "),s("ul",[s("li",[s("p",[t._v("强制关闭，相当于"),s("code",[t._v("kill -term/int")])]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[t._v("nginx -s stop\n")])])])]),t._v(" "),s("li",[s("p",[t._v("优雅关闭，相当于"),s("code",[t._v("kill -quit")])]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[t._v("nginx -s quit\n")])])])]),t._v(" "),s("li",[s("p",[t._v("重新打开日志文件，相当于"),s("code",[t._v("kill -usr1")])]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[t._v("nginx -s reopen\n")])])])]),t._v(" "),s("li",[s("p",[t._v("重新加载配置文件，相当于"),s("code",[t._v("kill -hup")])]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[t._v("nginx -s reload\n")])])])])]),t._v(" "),s("h1",{attrs:{id:"配置文件详解"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#配置文件详解"}},[t._v("#")]),t._v(" 配置文件详解")]),t._v(" "),s("h2",{attrs:{id:"全局块"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#全局块"}},[t._v("#")]),t._v(" 全局块")]),t._v(" "),s("table",[s("thead",[s("tr",[s("th",[t._v("全局指令")]),t._v(" "),s("th",[t._v("可选值")]),t._v(" "),s("th",[t._v("默认值")]),t._v(" "),s("th",[t._v("说明")])])]),t._v(" "),s("tbody",[s("tr",[s("td",[t._v("user")]),t._v(" "),s("td",[t._v("用户名")]),t._v(" "),s("td"),t._v(" "),s("td",[t._v("指定用户")])]),t._v(" "),s("tr",[s("td",[t._v("master_process")]),t._v(" "),s("td",[t._v("on/off")]),t._v(" "),s("td",[t._v("on")]),t._v(" "),s("td",[t._v("是否开启工作进程worker，配置完要重启nginx")])]),t._v(" "),s("tr",[s("td",[t._v("worker_processes")]),t._v(" "),s("td",[t._v("数字")]),t._v(" "),s("td"),t._v(" "),s("td",[t._v("worker进程数量，建议配置成cpu的数量，master_process开启才有用")])]),t._v(" "),s("tr",[s("td",[t._v("daemon")]),t._v(" "),s("td",[t._v("on/off")]),t._v(" "),s("td",[t._v("on")]),t._v(" "),s("td",[t._v("是否以守护进程方式启动")])]),t._v(" "),s("tr",[s("td",[t._v("pid")]),t._v(" "),s("td"),t._v(" "),s("td",[t._v("logs/nginx.pid")]),t._v(" "),s("td",[t._v("pid路径")])]),t._v(" "),s("tr",[s("td",[t._v("error_log")]),t._v(" "),s("td"),t._v(" "),s("td"),t._v(" "),s("td",[t._v("日志级别，debug、info、notice、warn、error、crit")])]),t._v(" "),s("tr",[s("td",[t._v("include")]),t._v(" "),s("td"),t._v(" "),s("td"),t._v(" "),s("td",[t._v("引入配置文件")])])])]),t._v(" "),s("h2",{attrs:{id:"events块"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#events块"}},[t._v("#")]),t._v(" events块")]),t._v(" "),s("table",[s("thead",[s("tr",[s("th",[t._v("指令")]),t._v(" "),s("th",[t._v("可选值")]),t._v(" "),s("th",[t._v("默认值")]),t._v(" "),s("th",[t._v("说明")])])]),t._v(" "),s("tbody",[s("tr",[s("td",[t._v("worker_connections")]),t._v(" "),s("td"),t._v(" "),s("td",[t._v("512")]),t._v(" "),s("td",[t._v("单个worker进程最大连接数")])]),t._v(" "),s("tr",[s("td",[t._v("accept_mutex")]),t._v(" "),s("td",[t._v("on/off")]),t._v(" "),s("td",[t._v("on")]),t._v(" "),s("td",[t._v("是否开启序列化，一个一个唤醒接收")])]),t._v(" "),s("tr",[s("td",[t._v("multi_accept")]),t._v(" "),s("td",[t._v("on/off")]),t._v(" "),s("td",[t._v("off")]),t._v(" "),s("td",[t._v("是否允许同时接收多个网络连接")])]),t._v(" "),s("tr",[s("td",[t._v("use")]),t._v(" "),s("td",[t._v("select/poll/epoll/kqueue")]),t._v(" "),s("td",[t._v("根据操作系统定")]),t._v(" "),s("td",[t._v("使用哪种事件驱动来处理网络消息")])])])]),t._v(" "),s("h2",{attrs:{id:"http块"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#http块"}},[t._v("#")]),t._v(" http块")]),t._v(" "),s("blockquote",[s("p",[t._v("default_type")])]),t._v(" "),s("p",[t._v("设置响应的MIME类型")]),t._v(" "),s("p",[t._v("语法："),s("code",[t._v("default_type mime-type")])]),t._v(" "),s("p",[t._v("默认："),s("code",[t._v("default_type text/plain")])]),t._v(" "),s("p",[t._v("作用域："),s("code",[t._v("http")]),t._v(", "),s("code",[t._v("server")]),t._v(", "),s("code",[t._v("location")])]),t._v(" "),s("blockquote",[s("p",[t._v("access_log")])]),t._v(" "),s("p",[t._v("日志输出路径")]),t._v(" "),s("p",[t._v("语法："),s("code",[t._v("access_log path [format]")])]),t._v(" "),s("p",[t._v("默认："),s("code",[t._v("logs/access.log")])]),t._v(" "),s("p",[t._v("作用域："),s("code",[t._v("http")]),t._v(", "),s("code",[t._v("server")]),t._v(", "),s("code",[t._v("location")]),t._v(", "),s("code",[t._v("if in location")])]),t._v(" "),s("blockquote",[s("p",[t._v("log_format")])]),t._v(" "),s("p",[t._v("日志格式化")]),t._v(" "),s("p",[t._v("语法："),s("code",[t._v("log_format name value")])]),t._v(" "),s("p",[t._v("作用域："),s("code",[t._v("http")])]),t._v(" "),s("blockquote",[s("p",[t._v("sendfile")])]),t._v(" "),s("p",[t._v("底层使用"),s("code",[t._v("sendfile")]),t._v("发送文件")]),t._v(" "),s("p",[t._v("语法："),s("code",[t._v("sendfile on|off")])]),t._v(" "),s("p",[t._v("默认："),s("code",[t._v("off")])]),t._v(" "),s("p",[t._v("作用域："),s("code",[t._v("http")]),t._v(", "),s("code",[t._v("server")]),t._v(", "),s("code",[t._v("location")]),t._v(","),s("code",[t._v("if in location")])]),t._v(" "),s("blockquote",[s("p",[t._v("keepalive_timeout")])]),t._v(" "),s("p",[t._v("tcp长连接超时时间")]),t._v(" "),s("p",[t._v("语法："),s("code",[t._v("keepalive_timeout timeout")])]),t._v(" "),s("p",[t._v("默认：75，不写单位默认是s")]),t._v(" "),s("p",[t._v("作用域："),s("code",[t._v("http")]),t._v(", "),s("code",[t._v("server")]),t._v(","),s("code",[t._v("location")])]),t._v(" "),s("blockquote",[s("p",[t._v("keepalive_requests")])]),t._v(" "),s("p",[t._v("一个连接使用次数")]),t._v(" "),s("p",[t._v("语法："),s("code",[t._v("keepalive_requests number")])]),t._v(" "),s("p",[t._v("默认：100")]),t._v(" "),s("p",[t._v("作用域："),s("code",[t._v("http")]),t._v(", "),s("code",[t._v("server")]),t._v(","),s("code",[t._v("location")])]),t._v(" "),s("h2",{attrs:{id:"server块"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#server块"}},[t._v("#")]),t._v(" server块")]),t._v(" "),s("blockquote",[s("p",[t._v("listen")])]),t._v(" "),s("p",[t._v("监听的端口")]),t._v(" "),s("p",[t._v("语法："),s("code",[t._v("listen port")])]),t._v(" "),s("p",[t._v("作用域："),s("code",[t._v("server")])]),t._v(" "),s("blockquote",[s("p",[t._v("server_name")])]),t._v(" "),s("p",[t._v("监听当前的ip或域名")]),t._v(" "),s("p",[t._v("语法："),s("code",[t._v("server_name name ...")])]),t._v(" "),s("p",[t._v("作用域："),s("code",[t._v("server")])]),t._v(" "),s("h2",{attrs:{id:"location块"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#location块"}},[t._v("#")]),t._v(" location块")]),t._v(" "),s("h3",{attrs:{id:"location"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#location"}},[t._v("#")]),t._v(" location")]),t._v(" "),s("blockquote",[s("p",[t._v("模糊匹配")])]),t._v(" "),s("div",{staticClass:"language-nginx extra-class"},[s("pre",{pre:!0,attrs:{class:"language-nginx"}},[s("code",[t._v("location /aaa\n")])])]),s("blockquote",[s("p",[t._v("精确匹配")])]),t._v(" "),s("div",{staticClass:"language-nginx extra-class"},[s("pre",{pre:!0,attrs:{class:"language-nginx"}},[s("code",[t._v("location =/aaa\n")])])]),s("blockquote",[s("p",[t._v("正则匹配（区分大小写）")])]),t._v(" "),s("div",{staticClass:"language-nginx extra-class"},[s("pre",{pre:!0,attrs:{class:"language-nginx"}},[s("code",[t._v("location ~^/aaa$\n")])])]),s("blockquote",[s("p",[t._v("正则匹配（不区分大小写）")])]),t._v(" "),s("div",{staticClass:"language-nginx extra-class"},[s("pre",{pre:!0,attrs:{class:"language-nginx"}},[s("code",[t._v("location ~*^/aaa$\n")])])]),s("p",[t._v("注意：?后面的值不参与"),s("code",[t._v("location")]),t._v("匹配")]),t._v(" "),s("h3",{attrs:{id:"root"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#root"}},[t._v("#")]),t._v(" root")]),t._v(" "),s("p",[t._v("资源文件目录，会拼上location的值，默认"),s("code",[t._v("root html")])]),t._v(" "),s("div",{staticClass:"language-nginx extra-class"},[s("pre",{pre:!0,attrs:{class:"language-nginx"}},[s("code",[s("span",{pre:!0,attrs:{class:"token directive"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("server")])]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token directive"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("listen")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("80")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token directive"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("location")]),t._v(" /")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token directive"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("root")]),t._v(" html")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    \n    "),s("span",{pre:!0,attrs:{class:"token directive"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("location")]),t._v(" /aaa")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token directive"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("root")]),t._v(" html")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("h3",{attrs:{id:"alias"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#alias"}},[t._v("#")]),t._v(" alias")]),t._v(" "),s("p",[t._v("资源文件目录")]),t._v(" "),s("div",{staticClass:"language-nginx extra-class"},[s("pre",{pre:!0,attrs:{class:"language-nginx"}},[s("code",[s("span",{pre:!0,attrs:{class:"token directive"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("server")])]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token directive"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("listen")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("80")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token directive"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("location")]),t._v(" /")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token directive"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("alias")]),t._v(" html/")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    \n    "),s("span",{pre:!0,attrs:{class:"token directive"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("location")]),t._v(" /aaa")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token directive"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("alias")]),t._v(" html")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("p",[t._v("注意：如果location匹配值以/结尾，那么alias也要以/结尾")]),t._v(" "),s("h3",{attrs:{id:"index"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#index"}},[t._v("#")]),t._v(" index")]),t._v(" "),s("p",[t._v("默认文件")]),t._v(" "),s("div",{staticClass:"language-nginx extra-class"},[s("pre",{pre:!0,attrs:{class:"language-nginx"}},[s("code",[s("span",{pre:!0,attrs:{class:"token directive"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("index")]),t._v(" index.htm index.html aaa.html bbb.html")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),s("h3",{attrs:{id:"error-page"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#error-page"}},[t._v("#")]),t._v(" error_page")]),t._v(" "),s("p",[t._v("页面发生错误时跳转的路径")]),t._v(" "),s("blockquote",[s("p",[t._v("写法1")])]),t._v(" "),s("div",{staticClass:"language-nginx extra-class"},[s("pre",{pre:!0,attrs:{class:"language-nginx"}},[s("code",[t._v("error_page 404 https://www.baidu.com\n")])])]),s("blockquote",[s("p",[t._v("写法2")])]),t._v(" "),s("div",{staticClass:"language-nginx extra-class"},[s("pre",{pre:!0,attrs:{class:"language-nginx"}},[s("code",[s("span",{pre:!0,attrs:{class:"token directive"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("location")]),t._v(" /")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token directive"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("root")]),t._v(" aaa")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token directive"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("error_page")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("404")]),t._v(" @error")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token directive"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("location")]),t._v(" @error")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token directive"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("200")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'this is 404'")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("h3",{attrs:{id:"try-files"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#try-files"}},[t._v("#")]),t._v(" try_files")]),t._v(" "),s("p",[t._v("尝试着找文件")]),t._v(" "),s("p",[t._v("/1.html")]),t._v(" "),s("p",[t._v("/1.html/index.html")]),t._v(" "),s("p",[t._v("/index.html")]),t._v(" "),s("div",{staticClass:"language-nginx extra-class"},[s("pre",{pre:!0,attrs:{class:"language-nginx"}},[s("code",[s("span",{pre:!0,attrs:{class:"token directive"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("try_files")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$uri")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$uri")]),t._v("/ /index.html")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),s("p",[t._v("尝试去找"),s("code",[t._v("$uri")]),t._v("这个文件，找不到"),s("code",[t._v("$uri")]),t._v("就去"),s("code",[t._v("$uri/")]),t._v("下的"),s("code",[t._v("index.html")]),t._v("文件，找不到就请求"),s("code",[t._v("/index.html")])]),t._v(" "),s("h2",{attrs:{id:"解决跨域"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#解决跨域"}},[t._v("#")]),t._v(" 解决跨域")]),t._v(" "),s("div",{staticClass:"language-nginx extra-class"},[s("pre",{pre:!0,attrs:{class:"language-nginx"}},[s("code",[s("span",{pre:!0,attrs:{class:"token directive"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("server")])]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n   "),s("span",{pre:!0,attrs:{class:"token directive"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("listen")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("7089")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n   "),s("span",{pre:!0,attrs:{class:"token directive"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("location")]),t._v(" /")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token directive"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("proxy_pass")]),t._v(" http://localhost:8089")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token directive"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("add_header")]),t._v(" Access-Control-Allow-Origin *")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token directive"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("add_header")]),t._v(" Access-Control-Allow-Methods *")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n   "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("h1",{attrs:{id:"rewrite模块详解"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#rewrite模块详解"}},[t._v("#")]),t._v(" rewrite模块详解")]),t._v(" "),s("h2",{attrs:{id:"常用全局变量"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#常用全局变量"}},[t._v("#")]),t._v(" 常用全局变量")]),t._v(" "),s("table",[s("thead",[s("tr",[s("th",[t._v("变量")]),t._v(" "),s("th",[t._v("说明")])])]),t._v(" "),s("tbody",[s("tr",[s("td",[t._v("$args")]),t._v(" "),s("td",[t._v('变量中存放了请求URL中的请求参数。比如http://192.168.200.133/server?arg1=value1&args2=value2中的"arg1=value1&arg2=value2"，功能和$query_string一样')])]),t._v(" "),s("tr",[s("td",[t._v("$http_user_agent")]),t._v(" "),s("td",[t._v("变量存储的是用户访问服务的代理信息(如果通过浏览器访问，记录的是浏览器的相关版本信息)")])]),t._v(" "),s("tr",[s("td",[t._v("$host")]),t._v(" "),s("td",[t._v("变量存储的是访问服务器的server_name值")])]),t._v(" "),s("tr",[s("td",[t._v("$document_uri")]),t._v(" "),s("td",[t._v('变量存储的是当前访问地址的URI。比如http://192.168.200.133/server?id=10&name=zhangsan中的"/server"，功能和$uri一样')])]),t._v(" "),s("tr",[s("td",[t._v("$document_root")]),t._v(" "),s("td",[t._v("变量存储的是当前请求对应location的root值，如果未设置，默认指向Nginx自带html目录所在位置")])]),t._v(" "),s("tr",[s("td",[t._v("$content_length")]),t._v(" "),s("td",[t._v("变量存储的是请求头中的Content-Length的值")])]),t._v(" "),s("tr",[s("td",[t._v("$content_type")]),t._v(" "),s("td",[t._v("变量存储的是请求头中的Content-Type的值")])]),t._v(" "),s("tr",[s("td",[t._v("$http_cookie")]),t._v(" "),s("td",[t._v("变量存储的是客户端的cookie信息，可以通过add_header Set-Cookie 'cookieName=cookieValue'来添加cookie数据")])]),t._v(" "),s("tr",[s("td",[t._v("$limit_rate")]),t._v(" "),s("td",[t._v("变量中存储的是Nginx服务器对网络连接速率的限制，也就是Nginx配置中对limit_rate指令设置的值，默认是0，不限制。")])]),t._v(" "),s("tr",[s("td",[t._v("$remote_addr")]),t._v(" "),s("td",[t._v("变量中存储的是客户端的IP地址")])]),t._v(" "),s("tr",[s("td",[t._v("$remote_port")]),t._v(" "),s("td",[t._v("变量中存储了客户端与服务端建立连接的端口号")])]),t._v(" "),s("tr",[s("td",[t._v("$remote_user")]),t._v(" "),s("td",[t._v("变量中存储了客户端的用户名，需要有认证模块才能获取")])]),t._v(" "),s("tr",[s("td",[t._v("$scheme")]),t._v(" "),s("td",[t._v("变量中存储了访问协议")])]),t._v(" "),s("tr",[s("td",[t._v("$server_addr")]),t._v(" "),s("td",[t._v("变量中存储了服务端的地址")])]),t._v(" "),s("tr",[s("td",[t._v("$server_name")]),t._v(" "),s("td",[t._v("变量中存储了客户端请求到达的服务器的名称")])]),t._v(" "),s("tr",[s("td",[t._v("$server_port")]),t._v(" "),s("td",[t._v("变量中存储了客户端请求到达服务器的端口号")])]),t._v(" "),s("tr",[s("td",[t._v("$server_protocol")]),t._v(" "),s("td",[t._v('变量中存储了客户端请求协议的版本，比如"HTTP/1.1"')])]),t._v(" "),s("tr",[s("td",[t._v("$request_body_file")]),t._v(" "),s("td",[t._v("变量中存储了发给后端服务器的本地文件资源的名称")])]),t._v(" "),s("tr",[s("td",[t._v("$request_method")]),t._v(" "),s("td",[t._v('变量中存储了客户端的请求方式，比如"GET","POST"等')])]),t._v(" "),s("tr",[s("td",[t._v("$request_filename")]),t._v(" "),s("td",[t._v("变量中存储了当前请求的资源文件的路径名")])]),t._v(" "),s("tr",[s("td",[t._v("$request_uri")]),t._v(" "),s("td",[t._v('变量中存储了当前请求的URI，并且携带请求参数，比如http://192.168.200.133/server?id=10&name=zhangsan中的"/server?id=10&name=zhangsan"')])])])]),t._v(" "),s("h2",{attrs:{id:"set"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#set"}},[t._v("#")]),t._v(" set")]),t._v(" "),s("p",[t._v("设置变量")]),t._v(" "),s("p",[t._v("语法："),s("code",[t._v("set $variable value")])]),t._v(" "),s("p",[t._v("作用域："),s("code",[t._v("server")]),t._v(", "),s("code",[t._v("location")]),t._v(", "),s("code",[t._v("if")])]),t._v(" "),s("h2",{attrs:{id:"if"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#if"}},[t._v("#")]),t._v(" if")]),t._v(" "),s("p",[t._v("条件判断")]),t._v(" "),s("p",[t._v("语法："),s("code",[t._v("if (condition) {}")])]),t._v(" "),s("p",[t._v("作用域："),s("code",[t._v("server")]),t._v(", "),s("code",[t._v("location")])]),t._v(" "),s("h2",{attrs:{id:"break"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#break"}},[t._v("#")]),t._v(" break")]),t._v(" "),s("p",[t._v("语法："),s("code",[t._v("break")])]),t._v(" "),s("p",[t._v("作用域："),s("code",[t._v("server")]),t._v(", "),s("code",[t._v("location")]),t._v(", "),s("code",[t._v("if")])]),t._v(" "),s("h2",{attrs:{id:"return"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#return"}},[t._v("#")]),t._v(" return")]),t._v(" "),s("p",[t._v("语法："),s("code",[t._v("return code URL")]),t._v(" "),s("code",[t._v("return [text]")]),t._v(" "),s("code",[t._v("return URL")])]),t._v(" "),s("p",[t._v("作用域："),s("code",[t._v("server")]),t._v(", "),s("code",[t._v("location")]),t._v(", "),s("code",[t._v("if")])]),t._v(" "),s("h2",{attrs:{id:"rewrite"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#rewrite"}},[t._v("#")]),t._v(" rewrite")]),t._v(" "),s("p",[t._v("对请求的uri进行重写")]),t._v(" "),s("p",[t._v("语法："),s("code",[t._v("rewrite regex replacement [flag]")])]),t._v(" "),s("p",[t._v("作用域："),s("code",[t._v("server")]),t._v(", "),s("code",[t._v("location")]),t._v(", "),s("code",[t._v("if")])]),t._v(" "),s("blockquote",[s("p",[t._v("flag可选值")])]),t._v(" "),s("ul",[s("li",[s("p",[t._v("last")]),t._v(" "),s("p",[t._v("停止当前location的执行，拿着uri重新去匹配location")])]),t._v(" "),s("li",[s("p",[t._v("break")]),t._v(" "),s("p",[t._v("停止当前location的执行，会在当前location去找对应的资源")])]),t._v(" "),s("li",[s("p",[t._v("redirect")]),t._v(" "),s("p",[t._v("临时重定向")])]),t._v(" "),s("li",[s("p",[t._v("permanent")]),t._v(" "),s("p",[t._v("永久重定向")])])]),t._v(" "),s("blockquote",[s("p",[t._v("使用示例")])]),t._v(" "),s("div",{staticClass:"language-nginx extra-class"},[s("pre",{pre:!0,attrs:{class:"language-nginx"}},[s("code",[s("span",{pre:!0,attrs:{class:"token directive"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("server")])]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token directive"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("listen")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("80")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token directive"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("location")]),t._v(" /")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token directive"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("rewrite")]),t._v(" /1.html /2.html last")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token directive"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("rewrite")]),t._v(" /2.html /3.html")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token directive"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("location")]),t._v(" /2.html")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token directive"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("rewrite")]),t._v(" /2.html /a.html")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token directive"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("location")]),t._v(" /3.html")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token directive"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("rewrite")]),t._v(" /3.html /b.html")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("h2",{attrs:{id:"rewrite-log"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#rewrite-log"}},[t._v("#")]),t._v(" rewrite_log")]),t._v(" "),s("p",[t._v("打印rewrite日志")]),t._v(" "),s("p",[t._v("语法："),s("code",[t._v("rewrite_log on | off")])]),t._v(" "),s("p",[t._v("作用域："),s("code",[t._v("http")]),t._v(", "),s("code",[t._v("server")]),t._v(", "),s("code",[t._v("location")]),t._v(", "),s("code",[t._v("if")])]),t._v(" "),s("div",{staticClass:"language-nginx extra-class"},[s("pre",{pre:!0,attrs:{class:"language-nginx"}},[s("code",[s("span",{pre:!0,attrs:{class:"token directive"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("rewrite_log")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("on")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token directive"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("error_log")]),t._v(" logs/error.log notice")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),s("h1",{attrs:{id:"反向代理"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#反向代理"}},[t._v("#")]),t._v(" 反向代理")]),t._v(" "),s("h2",{attrs:{id:"正向代理"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#正向代理"}},[t._v("#")]),t._v(" 正向代理")]),t._v(" "),s("div",{staticClass:"language-nginx extra-class"},[s("pre",{pre:!0,attrs:{class:"language-nginx"}},[s("code",[s("span",{pre:!0,attrs:{class:"token directive"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("location")]),t._v(" /")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token directive"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("proxy_pass")]),t._v(" http://10.8.0.61")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("h2",{attrs:{id:"反向代理-2"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#反向代理-2"}},[t._v("#")]),t._v(" 反向代理")]),t._v(" "),s("blockquote",[s("p",[t._v("被代理服务器")])]),t._v(" "),s("div",{staticClass:"language-nginx extra-class"},[s("pre",{pre:!0,attrs:{class:"language-nginx"}},[s("code",[s("span",{pre:!0,attrs:{class:"token directive"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("location")]),t._v(" /")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token directive"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("root")]),t._v("   html")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("blockquote",[s("p",[t._v("代理服务器")])]),t._v(" "),s("div",{staticClass:"language-nginx extra-class"},[s("pre",{pre:!0,attrs:{class:"language-nginx"}},[s("code",[s("span",{pre:!0,attrs:{class:"token directive"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("location")]),t._v(" /")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token directive"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("proxy_pass")]),t._v(" http://192.168.100.128")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("h2",{attrs:{id:"proxy-set-header"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#proxy-set-header"}},[t._v("#")]),t._v(" proxy_set_header")]),t._v(" "),s("p",[t._v("设置请求头信息")]),t._v(" "),s("p",[t._v("语法："),s("code",[t._v("proxy_set_header field value")])]),t._v(" "),s("p",[t._v("作用域："),s("code",[t._v("http")]),t._v(", "),s("code",[t._v("server")]),t._v(", "),s("code",[t._v("location")])]),t._v(" "),s("h2",{attrs:{id:"proxy-redirect"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#proxy-redirect"}},[t._v("#")]),t._v(" proxy_redirect")]),t._v(" "),s("p",[t._v("将被代理服务器的重定向地址替换成代理服务器的地址")]),t._v(" "),s("p",[t._v("语法："),s("code",[t._v("proxy_redirect redirect replacement")])]),t._v(" "),s("p",[t._v("作用域："),s("code",[t._v("http")]),t._v(", "),s("code",[t._v("server")]),t._v(", "),s("code",[t._v("location")])]),t._v(" "),s("blockquote",[s("p",[t._v("被代理服务器")])]),t._v(" "),s("div",{staticClass:"language-nginx extra-class"},[s("pre",{pre:!0,attrs:{class:"language-nginx"}},[s("code",[s("span",{pre:!0,attrs:{class:"token directive"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("events")])]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token directive"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("http")])]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token directive"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("server")])]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token directive"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("listen")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("80")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token directive"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("location")]),t._v(" /")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                        "),s("span",{pre:!0,attrs:{class:"token directive"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("root")]),t._v(" html")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                        "),s("span",{pre:!0,attrs:{class:"token directive"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("index")]),t._v(" index.html")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                        "),s("span",{pre:!0,attrs:{class:"token directive"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" (!-f "),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$request_filename")]),t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                                "),s("span",{pre:!0,attrs:{class:"token directive"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("302")]),t._v(" http://192.168.100.128:81")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n        "),s("span",{pre:!0,attrs:{class:"token directive"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("server")])]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token directive"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("listen")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("81")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token directive"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("location")]),t._v(" /")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                        "),s("span",{pre:!0,attrs:{class:"token directive"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("root")]),t._v(" html")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                        "),s("span",{pre:!0,attrs:{class:"token directive"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("index")]),t._v(" index.html")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("blockquote",[s("p",[t._v("代理服务器")])]),t._v(" "),s("div",{staticClass:"language-nginx extra-class"},[s("pre",{pre:!0,attrs:{class:"language-nginx"}},[s("code",[s("span",{pre:!0,attrs:{class:"token directive"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("events")])]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token directive"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("http")])]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token directive"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("server")])]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token directive"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("listen")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("80")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token directive"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("location")]),t._v(" /")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                        "),s("span",{pre:!0,attrs:{class:"token directive"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("proxy_redirect")]),t._v(" http://192.168.100.128 http://192.168.100.3")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                        "),s("span",{pre:!0,attrs:{class:"token directive"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("proxy_pass")]),t._v(" http://192.168.100.128")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token directive"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("server")])]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token directive"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("listen")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("81")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token directive"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("location")]),t._v(" /")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                        "),s("span",{pre:!0,attrs:{class:"token directive"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("proxy_pass")]),t._v(" http://192.168.100.128:81")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("h1",{attrs:{id:"负载均衡"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#负载均衡"}},[t._v("#")]),t._v(" 负载均衡")]),t._v(" "),s("h2",{attrs:{id:"upstream"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#upstream"}},[t._v("#")]),t._v(" upstream")]),t._v(" "),s("p",[t._v("定义一组服务器")]),t._v(" "),s("p",[t._v("语法："),s("code",[t._v("upstram name {}")])]),t._v(" "),s("p",[t._v("作用域："),s("code",[t._v("http")])]),t._v(" "),s("div",{staticClass:"language-nginx extra-class"},[s("pre",{pre:!0,attrs:{class:"language-nginx"}},[s("code",[s("span",{pre:!0,attrs:{class:"token directive"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("upstream")]),t._v(" myserver")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token directive"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("server")]),t._v(" 192.168.100.128")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token directive"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("server")]),t._v(" 192.168.100.128:81")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token directive"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("server")]),t._v(" 192.168.100.128:82")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token directive"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("server")])]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token directive"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("listen")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("80")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token directive"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("location")]),t._v(" /")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token directive"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("proxy_pass")]),t._v(" http://myserver")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("h2",{attrs:{id:"负载均衡状态"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#负载均衡状态"}},[t._v("#")]),t._v(" 负载均衡状态")]),t._v(" "),s("table",[s("thead",[s("tr",[s("th",[t._v("down")]),t._v(" "),s("th",[t._v("不参与负载均衡")])])]),t._v(" "),s("tbody",[s("tr",[s("td",[t._v("backup")]),t._v(" "),s("td",[t._v("备份服务器，当其他服务器挂掉了，才会启用备份服务器")])]),t._v(" "),s("tr",[s("td",[t._v("max_fails")]),t._v(" "),s("td",[t._v("允许请求失败的次数，默认是1")])]),t._v(" "),s("tr",[s("td",[t._v("fail_timeout")]),t._v(" "),s("td",[t._v("max_fails失败后，多少秒之内不访问失败的服务器，默认10秒")])])])]),t._v(" "),s("h2",{attrs:{id:"负载均衡策略"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#负载均衡策略"}},[t._v("#")]),t._v(" 负载均衡策略")]),t._v(" "),s("blockquote",[s("p",[t._v("weight")])]),t._v(" "),s("p",[t._v("分配权重")]),t._v(" "),s("div",{staticClass:"language-nginx extra-class"},[s("pre",{pre:!0,attrs:{class:"language-nginx"}},[s("code",[s("span",{pre:!0,attrs:{class:"token directive"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("upstream")]),t._v(" myserver")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token directive"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("server")]),t._v(" 192.168.100.128:80 weight=3")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token directive"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("server")]),t._v(" 192.168.100.128:81 weight=7")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token directive"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("server")]),t._v(" 192.168.100.128:82 weight=10")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("blockquote",[s("p",[t._v("ip_hash")])]),t._v(" "),s("p",[t._v("一个ip固定被分配到某一台服务器")]),t._v(" "),s("div",{staticClass:"language-nginx extra-class"},[s("pre",{pre:!0,attrs:{class:"language-nginx"}},[s("code",[s("span",{pre:!0,attrs:{class:"token directive"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("upstream")]),t._v(" myserver")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token directive"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("ip_hash")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token directive"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("server")]),t._v(" 192.168.100.128:80")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token directive"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("server")]),t._v(" 192.168.100.128:81")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token directive"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("server")]),t._v(" 192.168.100.128:82")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("blockquote",[s("p",[t._v("url_hash")])]),t._v(" "),s("p",[t._v("同一个url固定分配到某一台服务器")]),t._v(" "),s("div",{staticClass:"language-nginx extra-class"},[s("pre",{pre:!0,attrs:{class:"language-nginx"}},[s("code",[s("span",{pre:!0,attrs:{class:"token directive"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("upstream")]),t._v(" myserver")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token directive"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("hash")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$request_uri")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token directive"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("server")]),t._v(" 192.168.100.128")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token directive"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("server")]),t._v(" 192.168.100.128:81")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token directive"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("server")]),t._v(" 192.168.100.128:82")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("blockquote",[s("p",[t._v("least_conn")])]),t._v(" "),s("p",[t._v("把请求分配到连接最少的服务器上")]),t._v(" "),s("div",{staticClass:"language-nginx extra-class"},[s("pre",{pre:!0,attrs:{class:"language-nginx"}},[s("code",[s("span",{pre:!0,attrs:{class:"token directive"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("upstream")]),t._v(" myserver")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token directive"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("least_conn")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token directive"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("server")]),t._v(" 192.168.100.128:80")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token directive"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("server")]),t._v(" 192.168.100.128:81")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token directive"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("server")]),t._v(" 192.168.100.128:82")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("h1",{attrs:{id:"负载均衡之fair策略"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#负载均衡之fair策略"}},[t._v("#")]),t._v(" 负载均衡之fair策略")]),t._v(" "),s("p",[t._v("根据页面大小、加载时间等智能分配服务器")]),t._v(" "),s("blockquote",[s("p",[t._v("下载fair")])]),t._v(" "),s("p",[t._v("下载地址："),s("code",[t._v("https://github.com/gnosek/nginx-upstream-fair")])]),t._v(" "),s("blockquote",[s("p",[t._v("上传到服务器解压缩并重命名")])]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[t._v("unzip")]),t._v(" nginx-upstream-fair-master.zip\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("mv")]),t._v(" nginx-upstream-fair-master fair\n")])])]),s("blockquote",[s("p",[t._v("编辑nginx源码文件")])]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[t._v("vim")]),t._v(" /data/nginx-1.22.0/src/http/ngx_http_upstream.h\n")])])]),s("p",[t._v("找到"),s("code",[t._v("struct ngx_http_upstream_srv_conf_s")]),t._v("结构体")]),t._v(" "),s("p",[t._v("加上"),s("code",[t._v("in_port_t default_port;")])]),t._v(" "),s("blockquote",[s("p",[t._v("进入nginx安装目录")])]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("cd")]),t._v(" /data/nginx-1.22.0\n")])])]),s("blockquote",[s("p",[t._v("进行配置")])]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[t._v("./configure --add-module"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("/data/nginx-1.22.0/modules/fair\n")])])]),s("blockquote",[s("p",[t._v("进行编译")])]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[t._v("make")]),t._v("\n")])])]),s("blockquote",[s("p",[t._v("删除之前的nginx二进制文件")])]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[t._v("rm")]),t._v(" -rf /usr/local/nginx/sbin/nginx\n")])])]),s("blockquote",[s("p",[t._v("复制新的二进制文件")])]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[t._v("cp")]),t._v(" objs/nginx /usr/local/nginx/sbin\n")])])]),s("blockquote",[s("p",[t._v("进行平滑升级")])]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[t._v("make")]),t._v(" upgrade\n")])])]),s("blockquote",[s("p",[t._v("使用fair策略")])]),t._v(" "),s("div",{staticClass:"language-nginx extra-class"},[s("pre",{pre:!0,attrs:{class:"language-nginx"}},[s("code",[s("span",{pre:!0,attrs:{class:"token directive"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("upstream")]),t._v(" myserver")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t"),s("span",{pre:!0,attrs:{class:"token directive"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("fair")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\t"),s("span",{pre:!0,attrs:{class:"token directive"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("server")]),t._v(" 192.168.100.128:80")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\t"),s("span",{pre:!0,attrs:{class:"token directive"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("server")]),t._v(" 192.168.100.128:81")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\t"),s("span",{pre:!0,attrs:{class:"token directive"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("server")]),t._v(" 192.168.100.128:82")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("h1",{attrs:{id:"配置https"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#配置https"}},[t._v("#")]),t._v(" 配置https")]),t._v(" "),s("h2",{attrs:{id:"申请阿里云证书"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#申请阿里云证书"}},[t._v("#")]),t._v(" 申请阿里云证书")]),t._v(" "),s("blockquote",[s("p",[t._v("到域名控制台解析域名")])]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("https://dc.console.aliyun.com/next/index#/domain-list/all\n")])])]),s("blockquote",[s("p",[t._v("购买SSL证书")])]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("https://common-buy.aliyun.com/?commodityCode=cas_dv_public_cn\n")])])]),s("blockquote",[s("p",[t._v("申请证书")])]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("https://yundunnext.console.aliyun.com/?p=casnext#/certExtend\n")])])]),s("blockquote",[s("p",[t._v("下载证书，并上传到服务器")])]),t._v(" "),s("h2",{attrs:{id:"安装ssl模块"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#安装ssl模块"}},[t._v("#")]),t._v(" 安装ssl模块")]),t._v(" "),s("blockquote",[s("p",[t._v("进入到nginx安装包目录")])]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("cd")]),t._v(" /data/nginx-1.22.0\n")])])]),s("blockquote",[s("p",[t._v("清除之前编译的文件")])]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[t._v("make")]),t._v(" clean\n")])])]),s("blockquote",[s("p",[t._v("重新配置")])]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[t._v("./configure --with-http_ssl_module\n")])])]),s("blockquote",[s("p",[t._v("重新编译")])]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[t._v("make")]),t._v("\n")])])]),s("blockquote",[s("p",[t._v("删除之前的二进制文件")])]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[t._v("rm")]),t._v(" -rf /usr/local/nginx/sbin/nginx\n")])])]),s("blockquote",[s("p",[t._v("复制二进制文件")])]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[t._v("cp")]),t._v(" objs/nginx /usr/local/nginx/sbin\n")])])]),s("blockquote",[s("p",[t._v("进行平滑升级")])]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[t._v("make")]),t._v(" upgrade\n")])])]),s("h2",{attrs:{id:"进行配置"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#进行配置"}},[t._v("#")]),t._v(" 进行配置")]),t._v(" "),s("div",{staticClass:"language-nginx extra-class"},[s("pre",{pre:!0,attrs:{class:"language-nginx"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# https默认端口是443")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token directive"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("server")])]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token directive"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("listen")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("443")]),t._v(" ssl")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token directive"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("server_name")]),t._v(" localhost")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n \n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 证书路径")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token directive"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("ssl_certificate")]),t._v(" cert/server.crt")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token directive"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("ssl_certificate_key")]),t._v(" cert/server.key")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n \n    "),s("span",{pre:!0,attrs:{class:"token directive"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("ssl_session_timeout")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("5m")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token directive"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("ssl_ciphers")]),t._v(" ECDHE-RSA-AES128-GCM-SHA256:ECDHE:ECDH:AES:HIGH:!NULL:!aNULL:!MD5:!ADH:!RC4")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token directive"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("ssl_protocols")]),t._v(" TLSv1 TLSv1.1 TLSv1.2")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token directive"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("ssl_prefer_server_ciphers")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("on")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token directive"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("location")]),t._v(" /")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 代理地址，就是实际要访问的地址")]),t._v("\n    \t"),s("span",{pre:!0,attrs:{class:"token directive"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("proxy_pass")]),t._v(" https://www.baidu.com")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 将http://localhost重定向到https://localhost")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token directive"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("server")])]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token directive"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("listen")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("80")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token directive"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("server_name")]),t._v(" localhost")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token directive"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("301")]),t._v(" https://192.168.100.3"),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$request_uri")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("h1",{attrs:{id:"部署前端项目"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#部署前端项目"}},[t._v("#")]),t._v(" 部署前端项目")]),t._v(" "),s("h2",{attrs:{id:"普通部署"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#普通部署"}},[t._v("#")]),t._v(" 普通部署")]),t._v(" "),s("blockquote",[s("p",[t._v("若依官网拉取代码")])]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("https://gitee.com/y_project/RuoYi-Vue\n")])])]),s("blockquote",[s("p",[t._v("安装依赖")])]),t._v(" "),s("div",{staticClass:"language-powershell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-powershell"}},[s("code",[t._v("npm install\n")])])]),s("blockquote",[s("p",[t._v("打包后上传到服务器上")])]),t._v(" "),s("div",{staticClass:"language-powershell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-powershell"}},[s("code",[t._v("npm run build:prod\n")])])]),s("p",[t._v("打包完成后会生成dist文文件夹，将dist文件夹上传到服务器上")]),t._v(" "),s("blockquote",[s("p",[t._v("编辑配置文件")])]),t._v(" "),s("div",{staticClass:"language-nginx extra-class"},[s("pre",{pre:!0,attrs:{class:"language-nginx"}},[s("code",[s("span",{pre:!0,attrs:{class:"token directive"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("events")])]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token directive"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("http")])]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token directive"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("include")]),t._v(" mime.types")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token directive"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("server")])]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token directive"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("listen")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("80")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token directive"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("location")]),t._v(" /")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                        "),s("span",{pre:!0,attrs:{class:"token directive"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("root")]),t._v(" /usr/local/nginx/html/dist")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                        "),s("span",{pre:!0,attrs:{class:"token directive"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("try_files")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$uri")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$uri")]),t._v("/ /index.html")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        \n                "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 配置后端地址")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token directive"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("location")]),t._v(" /prod-api")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                        "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 转发到后端地址")]),t._v("\n                        "),s("span",{pre:!0,attrs:{class:"token directive"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("proxy_pass")]),t._v(" http://localhost:8081")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                        "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 去掉/prod-api")]),t._v("\n                        "),s("span",{pre:!0,attrs:{class:"token directive"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("rewrite")]),t._v(" ^/prod-api/(.*)$ /"),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$1")]),t._v(" break")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("blockquote",[s("p",[t._v("重新加载配置文件")])]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[t._v("nginx -s reload\n")])])]),s("h2",{attrs:{id:"整合jenkins、docker自动化部署"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#整合jenkins、docker自动化部署"}},[t._v("#")]),t._v(" 整合Jenkins、Docker自动化部署")]),t._v(" "),s("blockquote",[s("p",[t._v("编写nginx配置文件")])]),t._v(" "),s("div",{staticClass:"language-nginx extra-class"},[s("pre",{pre:!0,attrs:{class:"language-nginx"}},[s("code",[s("span",{pre:!0,attrs:{class:"token directive"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("server")])]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token directive"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("listen")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("81")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token directive"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("location")]),t._v(" /")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token directive"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("root")]),t._v(" /dist")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token directive"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("try_files")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$uri")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$uri")]),t._v("/ /index.html")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token directive"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("location")]),t._v(" /prod-api")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token directive"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("proxy_pass")]),t._v(" https://www.linzhehao.cn")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token directive"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("rewrite")]),t._v(" ^/prod-api/(.*)$ /ruoyi/"),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$1")]),t._v(" break")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("blockquote",[s("p",[t._v("编写dockerignore")])]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("node_modules\nsrc\npublic\n")])])]),s("blockquote",[s("p",[t._v("编写Dockerfile")])]),t._v(" "),s("div",{staticClass:"language-dockerfile extra-class"},[s("pre",{pre:!0,attrs:{class:"language-dockerfile"}},[s("code",[s("span",{pre:!0,attrs:{class:"token instruction"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("FROM")]),t._v(" nginx:1.22.0")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token instruction"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("EXPOSE")]),t._v(" 81")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token instruction"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("ENV")]),t._v(" LC_ALL=C.UTF-8")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token instruction"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("RUN")]),t._v(" rm -rf /etc/nginx/conf.d/default.conf")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token instruction"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("COPY")]),t._v(" nginx.conf /etc/nginx/conf.d/")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token instruction"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("COPY")]),t._v(" dist/ /dist/")]),t._v("\n")])])]),s("blockquote",[s("p",[t._v("编写Jenkins脚本")])]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[t._v("npm")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("npm")]),t._v(" run build:prod\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("rm")]),t._v(" ruoyi-ui -f\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" build -t ruoyi-ui "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(".")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" run -d --name ruoyi-ui -p "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("81")]),t._v(":81 ruoyi-ui\n")])])])])}),[],!1,null,null,null);s.default=n.exports}}]);